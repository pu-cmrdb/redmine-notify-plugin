<% content_for :header_tags do %>
  <style>
    .days_remaining .overdue { color: #d00; font-weight: bold; }
    .days_remaining .urgent { color: #ff8c00; font-weight: bold; }
    .nodata { font-style: italic; color: #999; text-align: center; padding: 20px; }
  </style>
<% end %>

<div class="contextual">
  <%= link_to l(:label_issue_new), new_project_issue_path(@project), class: 'icon icon-add' if User.current.allowed_to?(:add_issues, @project) %>
</div>

<h2><%= l(:label_issue_notifications) %></h2>

<% if @issues.any? %>
  <div class="autoscroll">
    <table class="list issues">
      <thead>
        <tr>
          <th>ID</th>
          <th><%= l(:field_subject) %></th>
          <th><%= l(:field_status) %></th>
          <th><%= l(:field_assigned_to) %></th>
          <th><%= l(:field_due_date) %></th>
          <th><%= l(:field_priority) %></th>
          <th><%= l(:label_days_remaining) %></th>
        </tr>
      </thead>
      <tbody>
        <% @issues.each do |issue| %>
          <tr class="<%= cycle('odd', 'even') %> <%= issue.css_classes %>">
            <td class="id">
              <%= link_to issue.id, issue_path(issue) %>
            </td>
            <td class="subject">
              <%= link_to truncate(issue.subject, length: 60), issue_path(issue) %>
            </td>
            <td class="status">
              <%= issue.status.name %>
            </td>
            <td class="assigned_to">
              <%= issue.assigned_to ? link_to_user(issue.assigned_to) : l(:label_unassigned) %>
            </td>
            <td class="due_date">
              <%= format_date(issue.due_date) %>
            </td>
            <td class="priority">
              <%= issue.priority.name %>
            </td>
            <td class="days_remaining">
              <% days_remaining = (issue.due_date - Date.today).to_i %>
              <span class="<%= days_remaining <= 0 ? 'overdue' : days_remaining <= 3 ? 'urgent' : '' %>">
                <% if days_remaining < 0 %>
                  <%= l(:label_overdue_by, count: days_remaining.abs) %>
                <% elsif days_remaining == 0 %>
                  <%= l(:label_due_today) %>
                <% else %>
                  <%= l(:label_due_in, count: days_remaining) %>
                <% end %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="nodata">
    <%= l(:label_no_issues_due) %>
  </p>
<% end %>

<% html_title(l(:label_issue_notifications)) %>
